# Для устройств с датчиком BL0942:

## *Передача показаний:*

* Все значения принимаются и обрабатываются с датчика BL0942 с шагом в 1 секунду.

### *Передача показаний в Zigbee осуществляется в формате:*

* AC frequency: 0.01 (Hz), шаг 0.02 Hz
* Current:  0.001 (A), минимальный шаг:  1 mA
* Voltage: 0.01 (V)
* Power: 3 Auto-mode: 0.1, 0.01, 0.001 (W)
* Summation delivered: 0.00001 (kWh), накопление с шагом менее 0.01 Wh

Значение “Voltage” * “Current” может не совпадать со значением “Power”, так как “Power” выводится с учетом “Power Factor”.

“Summation delivered” имеет более точные показания энергии с учетом “Power Factor”.

## *Настройки для BL0942*:

### Cluster ***0x0b04***: _Electrical Measurement_:

* Attribute ***0x0514***: _rms_extreme_over_voltage_period_ - период перезапуска в секундах после отключения реле по срабатыванию граничных порогов. Шаг обработки 1 секунда. При значении равному нулю перезапуск отключен. Единица измерения 1 секунда. По умолчанию 0 секунд - отключен.
* Attribute ***0x0515***: _rms_extreme_under_voltage_period_ - период проверки порогов при включении питания до включения реле. Шаг обработки 1 секунда. При значении равному нулю отключено. Единица измерения 1 секунда. По умолчанию 0 секунд - отключено.
* Attribute ***0x0517***: _rms_voltage_swell_period_ – период превышения тока до отключения в секундах. Шаг 1 секунда. При значении равному нулю отключение по превышению току отключено. Единица измерения 1 секунда. По умолчанию 8 секунд.
* Attribute ***0x0807***: _rms_extreme_over_voltage_ – значение максимального напряжения,  единица измерения 0.01V. Значение по умолчанию равно 260.00V. При превышении указанного напряжения реле отключается. При значении равному нулю отключение по превышению напряжения не производится.
* Attribute ***0x0808***: _rms_extreme_under_voltage_ – значение минимального напряжения,  единица измерения 0.01V. Значение по умолчанию равно 180.00V. Реле отключается при напряжении ниже указанного. При значении равному нулю отключение по пониженному напряжению не производится.
* Attribute ***0x080a***: _rms_voltage_swell_ – значение максимального тока,  единица измерения 0.001A. Значение по умолчанию равно 25.000A. При превышении указанного тока реле отключается. При значении равному нулю отключение по превышению тока отключено. Интервал длительности превышения тока задается в rms_voltage_swell_period.
* Attribute ***0xF007***: Coefficient for calculating _current_ – значение коэффициента множителя для счетчика тока. По умолчанию равен 16860520.
* Attribute ***0xF008***: Coefficient for calculating _voltage_ – значение коэффициента множителя для счетчика напряжения. По умолчанию равен 26927694.
* Attribute ***0xF009***: Coefficient for calculating _power_ – значение коэффициента множителя для счетчика мощности. По умолчанию равен 27060025.
* Attribute ***0xF00A***: Coefficient for calculating _energy_ – значение коэффициента множителя для счетчика энергии. По умолчанию равен 315272310.
* Attribute ***0xF00B***: Coefficient for calculating _freq_ – значение коэффициента для счетчика частоты. По умолчанию равен 100000000.

Примерное соотношение коэффициентов для расчета мощности и энергии после калибровки значений токов и напряжения с резистивной нагрузкой (PF = 1.0):

Kpower = (Kcurrent x  Kvoltage) / 16777216

Kenergy = Kpower x 419430.4 / 36000

Точность соотношений зависит от разбросов в попавшемся чипе BL0942, коэффициента мощности (PF) нагрузки и номиналов элементов делителей.


## *Калибровка BL0942:*

* Attribute ***0xF080***: _calibration_current_ – текущий ток в мА для калибровки. Пример: 3.541А -> 3541
* Attribute ***0xF081***: _calibration_voltage_ – текущее напряжение в десятках мВ для калибровки. Пример: 230.21В -> 23021
* Attribute ***0xF082***: _calibration_power_ – текущая мошность в сотых Вт для калибровки. Пример: 1800.5Вт -> 18005

При задании _calibration_power_ равного  “1” производится пересчет коэффициентов для расчета мощности и энергии, по ранее описанным соотношениям.

После ввода любого значения или нескольких калибровочных значений начинается отсчет 4-х циклов измерения BL0942 для накопления средних значений. 
Через 4-ре цикла измерений производится перерасчет выбранных типов коэффициентов для преобразования полученных от BL0942 значений в соответствующие единицы измерения.

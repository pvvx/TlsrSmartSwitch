# Для устройств с датчиком BL0937:

## Передача показаний:

* Значения “Current” и “Voltage” регистрируются поочередно с шагом в 1 секунду. По 4-ре раза для каждого значения за цикл измерения в 8 секунд.
* Значение “Power” регистрируются непрерывно с шагом 8 секунд с учетом “Power Factor” и имеет малое разрешение. “Summation delivered” набирается без потерь с максимальной точнотью.
* Все показания обрабатываются с шагом 8 секунд.
* “Power Factor” не передается чипом и в данной версии FW не вычисляется. 

### Передача показаний в Zigbee осуществляется в формате:

![grf_pl0937.gif](https://raw.githubusercontent.com/pvvx/TlsrSmartSwitch/refs/heads/master/img/grf_pl0937.gif)

* Current:  0.001 (A), минимальный шаг измерений:  2..3 mA
* Voltage: 0.01 (V), минимальный шаг измерений: 30 mV 
* Power:  3 Auto-mode: 0.1, 0.01 (W), минимум: 0.16 W
* Summation delivered: 0.00001 (kWh), накопление с шагом менее 0.01 Wh

Значение “Voltage” * “Current” может не совпадать со значением “Power”, так как “Power” выводится с учетом “Power Factor”.

“Summation delivered” имеет более точные показания энергии с учетом “Power Factor”.

![sens_pl0937.gif](https://raw.githubusercontent.com/pvvx/TlsrSmartSwitch/refs/heads/master/img/sens_pl0937.gif)

## Настройки:

### Cluster 0x0b04: Electrical Measurement:

* Attribute 0x0517: rms_voltage_swell_period – период превышения тока до отключения в секундах. Шаг 8 секунд. При значении равному нулю отключение по превышению току отключено. Единица измерения 1 секунда. По умолчанию 8 секунд.
* Attribute 0x0807: rms_extreme_over_voltage – значение максимального напряжения,  единица измерения 0.01В. Значение по умолчанию равно 260.00В. При превышении указанного напряжения реле отключается. При значении равному нулю отключение по превышению напряжения не производится. Следует учитывать интервал измерения в 8 секунд.
* Attribute 0x0808: rms_extreme_under_voltage – значение минимального напряжения,  единица измерения 0.01В. Значение по умолчанию равно 260.00В. Реле отключается при напряжении ниже указанного. При значении равному нулю отключение по пониженному напряжению не производится. Следует учитывать интервал измерения в 8 секунд.
* Attribute 0x080a: rms_voltage_swell – значение максимального тока,  единица измерения 0.001A. Значение по умолчанию равно 25.000А. При превышении указанного тока реле отключается. При значении равному нулю отключение по превышению току отключено. Интервал длительности превышения тока задается в rms_voltage_swell_period.
* Attribute 0x2200: Coefficient for calculating current– значение коэффициента множителя для счетчика импульсов тока. По умолчанию равен 178060.
* Attribute 0x2201: Coefficient for calculating voltage – значение коэффициента множителя для счетчика импульсов напряжения. По умолчанию равен 197732.
* Attribute 0x2202: Coefficient for calculating power – значение коэффициента множителя для счетчика импульсов мощности. По умолчанию равен 1081452.

Остальные настройки смотреть в [tuya_mini_relay_zrd](https://github.com/slacky1965/tuya_mini_relay_zrd).